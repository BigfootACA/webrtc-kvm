/*
 *
 * Copyright (C) 2024 BigfootACA <bigfoot@classfun.cn>
 *
 * SPDX-License-Identifier: GPL-3.0-or-later
 *
 */

#include"rkrga.h"
#include"lib/exception.h"
#include"string/strings.h"
#include<linux/videodev2.h>

uint32_t RgaFormatToFourcc(RgaSURF_FORMAT fmt){
	switch(fmt){
		case RK_FORMAT_Y4:return V4L2_PIX_FMT_Y4;
		case RK_FORMAT_Y8:return V4L2_PIX_FMT_GREY;
		case RK_FORMAT_YCbCr_420_P:return V4L2_PIX_FMT_YUV420;
		case RK_FORMAT_YCbCr_422_P:return V4L2_PIX_FMT_YUV422P;
		case RK_FORMAT_YCbCr_420_SP_10B:return V4L2_PIX_FMT_P010;
		case RK_FORMAT_YCrCb_444_SP:return V4L2_PIX_FMT_NV42;
		case RK_FORMAT_YCbCr_420_SP:return V4L2_PIX_FMT_NV12;
		case RK_FORMAT_YCbCr_422_SP:return V4L2_PIX_FMT_NV16;
		case RK_FORMAT_YCrCb_420_SP:return V4L2_PIX_FMT_NV21;
		case RK_FORMAT_YCrCb_422_SP:return V4L2_PIX_FMT_NV61;
		case RK_FORMAT_YCbCr_444_SP:return V4L2_PIX_FMT_NV24;
		case RK_FORMAT_YCbCr_400:return V4L2_PIX_FMT_GREY;
		case RK_FORMAT_YVYU_422:return V4L2_PIX_FMT_YVYU;
		case RK_FORMAT_VYUY_422:return V4L2_PIX_FMT_VYUY;
		case RK_FORMAT_YUYV_422:return V4L2_PIX_FMT_YUYV;
		case RK_FORMAT_UYVY_422:return V4L2_PIX_FMT_UYVY;
		case RK_FORMAT_RGB_565:return V4L2_PIX_FMT_RGB565;
		case RK_FORMAT_RGB_888:return V4L2_PIX_FMT_RGB24;
		case RK_FORMAT_BGR_888:return V4L2_PIX_FMT_BGR24;
		case RK_FORMAT_ARGB_8888:return V4L2_PIX_FMT_ARGB32;
		case RK_FORMAT_ABGR_8888:return V4L2_PIX_FMT_ABGR32;
		case RK_FORMAT_RGBA_8888:return V4L2_PIX_FMT_RGBA32;
		case RK_FORMAT_BGRA_8888:return V4L2_PIX_FMT_BGRA32;
		case RK_FORMAT_RGBX_8888:return V4L2_PIX_FMT_RGBX32;
		case RK_FORMAT_BGRX_8888:return V4L2_PIX_FMT_BGRX32;
		case RK_FORMAT_XRGB_8888:return V4L2_PIX_FMT_XRGB32;
		case RK_FORMAT_XBGR_8888:return V4L2_PIX_FMT_XBGR32;
		case RK_FORMAT_RGBA_5551:return V4L2_PIX_FMT_RGBA555;
		case RK_FORMAT_BGRA_5551:return V4L2_PIX_FMT_BGRA555;
		case RK_FORMAT_ARGB_5551:return V4L2_PIX_FMT_ARGB555;
		case RK_FORMAT_ABGR_5551:return V4L2_PIX_FMT_ABGR555;
		case RK_FORMAT_RGBA_4444:return V4L2_PIX_FMT_RGBA444;
		case RK_FORMAT_BGRA_4444:return V4L2_PIX_FMT_BGRA444;
		case RK_FORMAT_ARGB_4444:return V4L2_PIX_FMT_ARGB444;
		case RK_FORMAT_ABGR_4444:return V4L2_PIX_FMT_ABGR444;
		default:throw InvalidArgument("unsupported format: {}",(int)fmt);
	}
}

RgaSURF_FORMAT FourccToRgaFormat(uint32_t fourcc){
	switch(fourcc){
		case V4L2_PIX_FMT_Y4:return RK_FORMAT_Y4;
		case V4L2_PIX_FMT_P010:return RK_FORMAT_YCbCr_420_SP_10B;
		case V4L2_PIX_FMT_YUV420:return RK_FORMAT_YCbCr_420_P;
		case V4L2_PIX_FMT_YUV422P:return RK_FORMAT_YCbCr_422_P;
		case V4L2_PIX_FMT_NV24:return RK_FORMAT_YCbCr_444_SP;
		case V4L2_PIX_FMT_NV42:return RK_FORMAT_YCrCb_444_SP;
		case V4L2_PIX_FMT_NV12:return RK_FORMAT_YCbCr_420_SP;
		case V4L2_PIX_FMT_NV12M:return RK_FORMAT_YCbCr_420_SP;
		case V4L2_PIX_FMT_NV16:return RK_FORMAT_YCbCr_422_SP;
		case V4L2_PIX_FMT_NV16M:return RK_FORMAT_YCbCr_422_SP;
		case V4L2_PIX_FMT_NV21:return RK_FORMAT_YCrCb_420_SP;
		case V4L2_PIX_FMT_NV21M:return RK_FORMAT_YCrCb_420_SP;
		case V4L2_PIX_FMT_NV61:return RK_FORMAT_YCrCb_422_SP;
		case V4L2_PIX_FMT_NV61M:return RK_FORMAT_YCrCb_422_SP;
		case V4L2_PIX_FMT_GREY:return RK_FORMAT_YCbCr_400;
		case V4L2_PIX_FMT_YVYU:return RK_FORMAT_YVYU_422;
		case V4L2_PIX_FMT_VYUY:return RK_FORMAT_VYUY_422;
		case V4L2_PIX_FMT_YUYV:return RK_FORMAT_YUYV_422;
		case V4L2_PIX_FMT_UYVY:return RK_FORMAT_UYVY_422;
		case V4L2_PIX_FMT_RGB565:return RK_FORMAT_RGB_565;
		case V4L2_PIX_FMT_RGB24:return RK_FORMAT_RGB_888;
		case V4L2_PIX_FMT_BGR24:return RK_FORMAT_BGR_888;
		case V4L2_PIX_FMT_ARGB32:return RK_FORMAT_ARGB_8888;
		case V4L2_PIX_FMT_ABGR32:return RK_FORMAT_ABGR_8888;
		case V4L2_PIX_FMT_RGBA32:return RK_FORMAT_RGBA_8888;
		case V4L2_PIX_FMT_BGRA32:return RK_FORMAT_BGRA_8888;
		case V4L2_PIX_FMT_RGBX32:return RK_FORMAT_RGBX_8888;
		case V4L2_PIX_FMT_BGRX32:return RK_FORMAT_BGRX_8888;
		case V4L2_PIX_FMT_XRGB32:return RK_FORMAT_XRGB_8888;
		case V4L2_PIX_FMT_XBGR32:return RK_FORMAT_XBGR_8888;
		case V4L2_PIX_FMT_RGBA555:return RK_FORMAT_RGBA_5551;
		case V4L2_PIX_FMT_BGRA555:return RK_FORMAT_BGRA_5551;
		case V4L2_PIX_FMT_ARGB555:return RK_FORMAT_ARGB_5551;
		case V4L2_PIX_FMT_ABGR555:return RK_FORMAT_ABGR_5551;
		case V4L2_PIX_FMT_RGBA444:return RK_FORMAT_RGBA_4444;
		case V4L2_PIX_FMT_BGRA444:return RK_FORMAT_BGRA_4444;
		case V4L2_PIX_FMT_ARGB444:return RK_FORMAT_ARGB_4444;
		case V4L2_PIX_FMT_ABGR444:return RK_FORMAT_ABGR_4444;
		default:throw InvalidArgument("unsupported fourcc: {}",FourccToString(fourcc));
	}
}
